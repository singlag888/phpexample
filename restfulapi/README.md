Restful API
===========

[慕客网Restful API教程](https://www.imooc.com/learn/811)  

## 特点
    
    面向资源型服务接口
    适合效率要求高，安全性要求不高(使用HTTP验证)。

## 设计RESTful API 6要素

### 1.资源路径(URI)

	每个网址代表一种资源，所以网址中不能有动词，只能有名词。一般来说api中的名词使用复数。
	如：https://www.example.com/v1/zoos //动物园资源

### 2.HTTP动词
    对资源操作(CURD)
        GET
        POST
        PUT
        PATCH :
        DELETE

### 3.过滤信息

    api提供参数，过滤返回结果。
    
### 4.状态码
    
    200 ok 服务器成功返回用户请求的数据
    201 CREATED 新建或修改数据成功
    204 NO CONTENT 删除数据成功
    400 BAD REQUEST 用户发出的请求有错误
    401 Unauthorized 用户没有经过认证，无法进行此操作
    403 Forbidden 用户访问被禁止
    404 Not Found 找不到资源
    422 Unprocesable Entity 创建一个对象时，发生一个验证错误。
    500 服务器内部错误   
    
### 5.错误处理

    如果状态码是4xx或者5xx,应该向用户返回出错信息。 
      
### 6.返回结果

	针对不同操作，服务器向用户返回的结果应该符合以下规范：
	GET /collections 返回资源对象的列表(数组)
	GET /collections/identify 返回单个资源对象
	POST /collections 返回新生成的资源对象
	PUT  /collections/identify 返回完整的资源对象
	PATCH /collections/identify 返回被修改的属性
	DELETE /collections/identify 返回一个空文档


## 确认设计要素

### 项目需求

    用户登录，注册
    文章发表、编辑、管理、列表

### 六要素确定

确认设计要素

1.资源路径
/users 、 /articles

2.HTTP动词
GET,POST,DELETE,PUT

3.过滤信息
文章的分页筛选

4.状态码
200,404,422,403

5.错误处理
输出JSON格式错误信息

6.返回结果
输出JSON数组或JSON对象


## 数据库设计

用户表

ID，用户名，密码，注册时间

文章表

文章ID，标题，内容，发表时间，用户ID


sql语句使用`MySqlWorkbench`生成。

```sql
-- MySQL Script generated by MySQL Workbench
-- Fri Dec 22 13:29:10 2017
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema api
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema api
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `api` DEFAULT CHARACTER SET utf8 ;
USE `api` ;

-- -----------------------------------------------------
-- Table `api`.`user`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `api`.`user` ;

CREATE TABLE IF NOT EXISTS `api`.`user` (
  `user_id` INT NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(20) NOT NULL,
  `password` CHAR(32) NOT NULL,
  `create_time` DATETIME NOT NULL,
  PRIMARY KEY (`user_id`),
  INDEX `username` (`username` ASC),
  INDEX `create_time` (`create_time` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `api`.`article`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `api`.`article` ;

CREATE TABLE IF NOT EXISTS `api`.`article` (
  `article_id` INT NOT NULL AUTO_INCREMENT,
  `title` VARCHAR(40) NOT NULL,
  `content` VARCHAR(45) NOT NULL,
  `user_id` INT NOT NULL,
  PRIMARY KEY (`article_id`),
  INDEX `fk_article_user_idx` (`user_id` ASC),
  CONSTRAINT `fk_article_user`
    FOREIGN KEY (`user_id`)
    REFERENCES `api`.`user` (`user_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

```

## 其它

### apache 配置文件

```conf
    <VirtualHost *:80>
        <Directory "/Users/hello/PhpstormProjects/example">
            Options Indexes FollowSymLinks
            AllowOverride All
        </Directory>
        
        DocumentRoot "/Users/hello/PhpstormProjects/example"
        ServerName phpexample.com
        ErrorLog "logs/phpexample.com-error_log"
        CustomLog "logs/phpexample.com-access_log" common
    </VirtualHost>
```

添加`AllowOverride All`因为访问时使用 `restful/articles` 提示404，使用 `restful/index.php/articles` ，才能访问。

参考: (https://www.imooc.com/qadetail/211091)

